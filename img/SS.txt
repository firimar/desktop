https://raw.githubusercontent.com/HappyEnd0315/shadowsocks_install/master/ss.module

安装finalspeed

wget --no-check-certificate https://raw.githubusercontent.com/HappyEnd0315/shadowsocks_install/master/install_fs.sh
chmod +x install_fs.sh
./install_fs.sh 2>&1 | tee install.log

加入开机自启动
/etc/rc.local 
sh /fs/start.sh 

安装ipsec
wget https://raw.githubusercontent.com/quericy/one-key-ikev2-vpn/master/one-key-ikev2.sh

chmod +x one-key-ikev2.sh

bash one-key-ikev2.sh

（vps类型选2，其他不填

/usr/local/sbin/ipsec start

/usr/local/etc/ipsec.secrets

ss服务端安装libsodium支持chacha20

yum -y groupinstall "Development Tools"
wget https://github.com/jedisct1/libsodium/releases/download/1.0.11/libsodium-1.0.11.tar.gz
tar xf libsodium-1.0.11.tar.gz && cd libsodium-1.0.11
./configure && make -j2 && make install
echo /usr/local/lib > /etc/ld.so.conf.d/usr_local_lib.conf
ldconfig

安装shadowsocks

yum install git

获取源代码

cd /usr/local

git clone -b manyuser https://github.com/shadowsocksr/shadowsocksr.git

cd /usr/local/shadowsocksr/
bash initcfg.sh

# python server.py -p 9527 -k worry -m chacha20 -O auth_sha1_v4 -o http_simple


进入/usr/local/shadowsocksr
修改user-config.json中的server_port，password等字段，具体可参见：
https://github.com/breakwa11/shadowsocks-rss/wiki/config.json

维护命令：
启动：/etc/init.d/shadowsocks start
停止：/etc/init.d/shadowsocks stop
重启：/etc/init.d/shadowsocks restart
状态：/etc/init.d/shadowsocks status
配置文件路径：/etc/shadowsocks.json
日志文件路径：/var/log/shadowsocks.log
安装路径：/usr/local/shadowsocksr/shadowsocks

进入shadowsocks目录
cd /usr/local/shadowsocksr/shadowsocks
执行
git pull
成功后重启ss服务

git stash
git pull
git stash pop
然后可以使用git diff -w +文件名 来确认代码自动合并的情况.
如果希望用代码库中的文件完全覆盖本地工作版本. 方法如下:
git reset --hard
git pull
 
设置定时重启

cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 


yum install vixie-cron
yum install crontabs
 
chkconfig –level 35 crond on 
crontab -e

00 01 * * * /sbin/reboot
00 04 * * * /sbin/reboot
00 07 * * * /sbin/reboot
00 10 * * * /sbin/reboot
00 13 * * * /sbin/reboot
00 16 * * * /sbin/reboot
00 19 * * * /sbin/reboot
00 22 * * * /sbin/reboot 
esc : wq

重启服务使任务生效：
service crond restart 


安装libsodium支持chacha20

yum -y groupinstall "Development Tools"
wget https://github.com/jedisct1/libsodium/releases/download/1.0.11/libsodium-1.0.11.tar.gz
tar xf libsodium-1.0.11.tar.gz && cd libsodium-1.0.11
./configure && make -j2 && make install
echo /usr/local/lib > /etc/ld.so.conf.d/usr_local_lib.conf
ldconfig

设置开机启动脚本
cd /etc/init.d/
vi shadowsocks
复制以下内容
############################
#!/bin/sh
# chkconfig: 2345 90 10
# description: Start or stop the Shadowsocks R server
#
### BEGIN INIT INFO
# Provides: Shadowsocks-R
# Required-Start: $network $syslog
# Required-Stop: $network
# Default-Start: 2 3 4 5
# Default-Stop: 0 1 6
# Description: Start or stop the Shadowsocks R server
### END INIT INFO

# Author: Yvonne Lu(Min) <min@utbhost.com>

name=shadowsocks
PY=/usr/bin/python
SS=/usr/local/shadowsocksr/shadowsocks/server.py
SSPY=server.py
conf=/usr/local/shadowsocksr/user-config.json

start(){
    $PY $SS -c $conf -d start
    RETVAL=$?
    if [ "$RETVAL" = "0" ]; then
        echo "$name start success"
    else
        echo "$name start failed"
    fi
}

stop(){
    pid=`ps -ef | grep -v grep | grep -v ps | grep -i "${SSPY}" | awk '{print $2}'`
    if [ ! -z $pid ]; then
        $PY $SS -c $conf -d stop
        RETVAL=$?
        if [ "$RETVAL" = "0" ]; then
            echo "$name stop success"
        else
            echo "$name stop failed"
        fi
    else
        echo "$name is not running"
        RETVAL=1
    fi
}

status(){
    pid=`ps -ef | grep -v grep | grep -v ps | grep -i "${SSPY}" | awk '{print $2}'`
    if [ -z $pid ]; then
        echo "$name is not running"
        RETVAL=1
    else
        echo "$name is running with PID $pid"
        RETVAL=0
    fi
}

case "$1" in
'start')
    start
    ;;
'stop')
    stop
    ;;
'status')
    status
    ;;
'restart')
    stop
    start
    RETVAL=$?
    ;;
*)
    echo "Usage: $0 { start | stop | restart | status }"
    RETVAL=1
    ;;
esac
exit $RETVAL
#######################

esc : wq

chmod 755 /etc/rc.d/init.d/shadowsocks && chkconfig --add shadowsocks && service shadowsocks start
