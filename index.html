<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
    >
    <title>iframe</title>
    <script src="js/messenger.js"></script>

</head>

<body>
    <div class="container">
        <p>
            <span class="label label-danger">iframe</span>
            This is a iframe under the domain:
            <script>document.write('(' + location.protocol + '//' + location.host + ')');</script>
        </p>

        <p>
            <input
                type="text"
                placeholder="输入消息"
                id="message"
            />
            <button
                type="button"
                class="btn btn-primary"
                onclick="sendMessage('parent');"
            >send to parent</button>
            <button
                type="button"
                class="btn btn-success"
                onclick="sendAll();"
            >send to all</button>
        </p>
        <pre
            id="output"
            class="alert alert-warning"
        ></pre>

    </div>

    <script>
        var messenger = new Messenger('iframe', 'Facebook'),
            input = document.getElementById('message');

        messenger.listen(function (msg) {
            console.log(msg);
            var newline = '\n';
            var text = document.createTextNode(msg + newline);
            document.getElementById('output').appendChild(text);
        });

        messenger.addTarget(window.parent, 'parent');

        function sendMessage(name) {
            var msg = input.value;
            messenger.targets[name].send("message from iframe: " + msg);
            input.value = '';
        }

        function sendAll() {
            var msg = input.value;
            messenger.send("message from iframe: " + msg);
            input.value = '';
        }
    </script>
</body>

</html>